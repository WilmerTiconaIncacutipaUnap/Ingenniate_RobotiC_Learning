// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace TiendaJapSoftware.Client.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using TiendaJapSoftware.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using TiendaJapSoftware.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using TiendaJapSoftware.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Authentication;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Blazored.SessionStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using TiendaJapSoftware.Client.Servicios;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.Extensions.Logging;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using System.Net.Http.Headers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\_Imports.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/IniciarSesion")]
    public partial class LogIn : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 62 "D:\Videos\Ejemplos codigo\TiendaJapSoftware\TiendaJapSoftware\Client\Pages\LogIn.razor"
       

    UsuarioLogIn usuarioLogin = new UsuarioLogIn();
    Boolean mostrarError = false;
    String mensajeError = String.Empty;
    Boolean mostraCapaPass = false;
    Usuario usuarioAux;
    String textoAux = String.Empty;
    String urlResultado = String.Empty;


    public void HandleValidSubmit()
    {
        Console.WriteLine("OnValidSubmit");
    }

    protected async override Task OnInitializedAsync()
    {
        try
        {
            var estadoAutenticaion = await authenticationStateProvider.GetAuthenticationStateAsync();
            var user = estadoAutenticaion.User;
            if (user.Identity.IsAuthenticated)
            {
                StateHasChanged();
                navigationmanager.NavigateTo("/MisCursos");
            }
        }
        catch (Exception ex)
        {
            l.LogError("Se produjo un error: " + ex.ToString());
            mostrarError = true;
        }
    }

    private async void ValidarUsuario()
    {
        try
        {
            if (usuarioLogin.EmailLogin != null && usuarioLogin.Password != null)
            {

                var respuesta = await servicioTienda.ValidarUsuario(usuarioLogin);

                if (respuesta.IsSuccessStatusCode)
                {

                    UsuarioLogIn usuarioLogInRespuesta = await respuesta.Content.ReadFromJsonAsync<UsuarioLogIn>();
                    if (usuarioLogInRespuesta.error == null || usuarioLogInRespuesta.error.mensaje == String.Empty)
                    {
                        await almacenarSesion.SetItemAsync("email", usuarioLogin.EmailLogin);
                        navigationmanager.NavigateTo("/MisCursos", true);
                    }
                    else
                    {
                        if (usuarioLogInRespuesta.error.mostrarEnPantalla)
                        {
                            mostrarError = true;
                            mensajeError = usuarioLogInRespuesta.error.mensaje;
                            StateHasChanged();

                        }
                        else
                        {
                            l.LogError("Se produjo un error: " + usuarioLogInRespuesta.error.mensaje);
                            throw new Exception("Intentelo de nuevo se produjo un error");
                        }
                    }
                }
                else
                    throw new Exception("Intentelo de nuevo se produjo un error");
            }
        }
        catch (Exception ex)
        {
            l.LogError("Se produjo un error: " + ex.ToString());
            mostrarError = true;
        }
    }

    private void cerrarCapa()
    {
        mostrarError = false;
    }


    private void RecuperarPass()
    {
        textoAux = String.Empty;
        mostraCapaPass = true;
    }

    private void cerrarCapaPass()
    {
        mostraCapaPass = false;
    }

    private void cambioTexto(string e)
    {
        textoAux = e;
    }


    private async void cambiarPass()
    {
        try
        {
            if (textoAux == String.Empty)
                textoAux = "No especificado";
            //Validamos que el email introducido existe en nuestro sistema. No agregamos el token porque ya lo
            // tenemos incrustado
            usuarioAux = await servicioTienda.DatosUsaurio(textoAux);
            if (usuarioAux.error == null)
            {
                string parametro = await servicioTienda.Cifrar(textoAux);
                urlResultado = "https://localhost:44312/CambioPass/" + parametro;
                StateHasChanged();
            }
            else
                servicioTienda.comprobarError(usuarioAux.error);
        }
        catch (Exception ex)
        {
            l.LogError("Se produjo un error: " + ex.ToString());
            mostrarError = true;
            StateHasChanged();
        }


    }




#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IServicesTienda servicioTienda { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IConfiguration Configuration { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ILogger<LogIn> l { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AuthenticationStateProvider authenticationStateProvider { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager navigationmanager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private ISessionStorageService almacenarSesion { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient ClienteHttp { get; set; }
    }
}
#pragma warning restore 1591
